<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Universe Simulation</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <!-- Import map for Three.js modules from CDN -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/",
            "three/addons/renderers/SVGRenderer.js": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/renderers/SVGRenderer.js"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { SVGRenderer } from 'three/addons/renderers/SVGRenderer.js';

        let scene, camera, renderer, controls;
        const planets = [];
        let ufo;

        function init() {
            // 1. Scene (场景)
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0, 0, 0);

            // 2. Camera (相机)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 50, 150);

            // 3. Renderer (渲染器) - Using SVGRenderer for maximum compatibility.
            renderer = new SVGRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // 4. Controls (轨道控制器)
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // 5. Lights (灯光)
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); // Increased intensity for SVG
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 5, 500); // Increased intensity for SVG
            scene.add(pointLight);

            // --- Create Celestial Bodies (创建天体) ---

            createStarfield();
            createSun();
            createSolarSystem();
            createBlackHole();
            createUFO();

            // --- Event Listeners ---
            window.addEventListener('resize', onWindowResize, false);

            animate();
        }

        // 创建星空背景
        function createStarfield() {
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = THREE.MathUtils.randFloatSpread(2000);
                const y = THREE.MathUtils.randFloatSpread(2000);
                const z = THREE.MathUtils.randFloatSpread(2000);
                starVertices.push(x, y, z);
            }
            const starGeometry = new THREE.BufferGeometry();
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            // SVGRenderer does not support PointsMaterial well, so we skip the stars
            // const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7 });
            // const stars = new THREE.Points(starGeometry, starMaterial);
            // scene.add(stars);
        }

        // 创建太阳
        function createSun() {
            const sunGeometry = new THREE.SphereGeometry(15, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffdd00 });
            const sun = new THREE.Mesh(sunGeometry, sunMaterial);
            scene.add(sun);
        }
        
        // 创建太阳系
        function createSolarSystem() {
            // (名字, 颜色, 大小, 轨道半径, 公转速度)
            addPlanet("Mercury", 0x8c8c8c, 2, 30, 0.02);
            addPlanet("Venus", 0xa57c1b, 4, 50, 0.012);
            addPlanet("Earth", 0x0077be, 4.5, 75, 0.01);
            addPlanet("Mars", 0xc1440e, 3.5, 100, 0.008);
            addPlanet("Jupiter", 0xd8ca9d, 8, 140, 0.004);
        }

        function addPlanet(name, color, size, distance, speed) {
            const planetGeometry = new THREE.SphereGeometry(size, 12, 12); // Reduced segments for SVG
            const planetMaterial = new THREE.MeshBasicMaterial({ color: color });
            const planet = new THREE.Mesh(planetGeometry, planetMaterial);
            
            const pivot = new THREE.Object3D();
            scene.add(pivot);
            pivot.add(planet);

            planet.position.x = distance;

            // Add moon to Earth
            if (name === "Earth") {
                const moonGeometry = new THREE.SphereGeometry(size * 0.27, 12, 12);
                const moonMaterial = new THREE.MeshBasicMaterial({ color: 0xcccccc });
                const moon = new THREE.Mesh(moonGeometry, moonMaterial);
                moon.position.x = size + 4; // Position relative to the Earth
                planet.add(moon); // Add moon as a child of the Earth
                planets.push({ name: "Moon-Parent", pivot: planet, speed: 0.05 }); // Add Earth to planets array to rotate it
            }

            const orbitGeometry = new THREE.RingGeometry(distance - 0.1, distance + 0.1, 128);
            const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.2 });
            const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
            orbit.rotation.x = Math.PI / 2;
            scene.add(orbit);

            planets.push({ name, pivot, speed });
        }

        // 创建黑洞
        function createBlackHole() {
            const blackHoleGroup = new THREE.Group();

            const holeGeometry = new THREE.SphereGeometry(10, 12, 12);
            const holeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const hole = new THREE.Mesh(holeGeometry, holeMaterial);
            blackHoleGroup.add(hole);

            const diskGeometry = new THREE.TorusGeometry(25, 8, 2, 24);
            const diskMaterial = new THREE.MeshBasicMaterial({ color: 0xffa500, side: THREE.DoubleSide });
            const accretionDisk = new THREE.Mesh(diskGeometry, diskMaterial);
            accretionDisk.rotation.x = Math.PI / 2 + 0.2;
            blackHoleGroup.add(accretionDisk);
            
            blackHoleGroup.position.set(-250, 20, -150);
            scene.add(blackHoleGroup);
            
            planets.push({ name: "BlackHoleDisk", pivot: accretionDisk, speed: 0.015 });
        }

        function createUFO() {
            const ufoGroup = new THREE.Group();

            const bodyMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa });
            const bodyGeom = new THREE.CylinderGeometry(4, 1, 2, 16);
            const ufoBody = new THREE.Mesh(bodyGeom, bodyMaterial);
            ufoGroup.add(ufoBody);

            const domeMaterial = new THREE.MeshBasicMaterial({ color: 0x00ddff });
            const domeGeom = new THREE.SphereGeometry(2, 16, 8, 0, Math.PI * 2, 0, Math.PI / 2);
            const ufoDome = new THREE.Mesh(domeGeom, domeMaterial);
            ufoDome.position.y = 1.5;
            ufoGroup.add(ufoDome);

            ufoGroup.position.set(200, 50, -200);
            ufoGroup.scale.set(2, 2, 2);
            scene.add(ufoGroup);
            ufo = ufoGroup;
        }
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);

            // 更新行星公转
            planets.forEach(p => {
                p.pivot.rotation.y += p.speed;
            });

            // Animate UFO
            if (ufo) {
                ufo.position.x -= 0.5;
                ufo.position.z += 0.2;
                if (ufo.position.x < -300) {
                    ufo.position.x = 300;
                    ufo.position.z = -200;
                }
            }

            controls.update();
            renderer.render(scene, camera);
        }

        // 窗口大小调整
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
    </script>
</body>
</html>
